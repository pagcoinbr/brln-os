<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes do Node</title>
    <link rel="icon" type="image/png" href="logopreto.png">
    <style>
        body {
            background-image: url('sky.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            margin: 0;
        }

        .botao {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.3s;
        }

        .botao:hover {
            background-color: #218838;
        }

        /* Bot√£o piscando */
        @keyframes piscar {
            0%, 100% { 
            box-shadow: 0 0 10px #ffffff88, 0 0 20px #ffffff88; 
            }
            50% { 
            box-shadow: 0 0 25px #00ff37, 0 0 40px #ffffff; 
            }
        }

        /* Classe extra para bot√µes que piscam */
        .piscando {
            animation: piscar 2s infinite ease-in-out;
        }

        .section {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            width: 90%;
            box-sizing: border-box;
        }

        .status {
            font-size: 18px;
            margin: 10px 0;
        }

        .back {
            width: auto;
            max-width: 90%;
            font-size: 16px;
            padding: 12px 24px;
            text-align: center;
            box-sizing: border-box;
        }

        .voltar-container {
            margin-top: 30px;
            margin-bottom: 40px;
            display: flex;
            justify-content: center;
        }

        pre {
            background-color: #eee;
            padding: 10px;
            text-align: left;
            max-height: 300px;
            overflow: auto;
            font-size: 14px;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 768px) {
            .botao {
                font-size: 14px;
                padding: 10px 20px;
            }

            .status {
                font-size: 16px;
            }
        }

    </style>
</head>
<body>

    <h1>‚öôÔ∏è Painel de Configura√ß√µes</h1>

    <div class="section">
        <h2>üìä Status do Sistema</h2>
        <div id="cpu" class="status">CPU: ...</div>
        <div id="ram" class="status">RAM: ...</div>
        <div id="lnd" class="status">LND: ...</div>
        <div id="bitcoind" class="status">Bitcoind: ...</div>
        <div id="tor" class="status">Tor: ...</div>
        <div id="blockchain" class="status">Blockchain: ...</div>

    </div>
    <div class="section">
        <h2>üñ•Ô∏è Painel de Controle</h2>
        <br><br>
        <a>Para colar no terminal utilize, Ctrl + Shift + V</a>
        <br><br>
        <button class="botao piscando" onclick="abrirApp(3131)">‚ö° BRLN FullAuto</button>
        <button class="botao" onclick="abrirApp(3232)">üñ•Ô∏è Acessar Terminal Web</button>
        <br>
        <button class="botao" onclick="abrirApp(3535)">‚ö° Ver Logs do LND</button>
        <button class="botao" onclick="abrirApp(3434)">ü™ô Ver Logs do Bitcoind</button>
        <br>
        <button class="botao" onclick="abrirApp(3333)">‚úèÔ∏è Editar lnd.conf</button>
        <button class="botao" onclick="abrirApp(3636)">‚úèÔ∏è Editar bitcoin.conf</button>
        <br><br>
        <a>üõ†Ô∏è Ferramentas Extras</a>
        <br><br>
        <a href="https://tools.bitbo.io/fee-calculator/" class="botao" target="_blank">üîó On-chain Fee Calculator</a>
        <button class="botao" onclick="alternarTema()">üåó Alternar Tema</button>
        <h1>Gerenciador de Servi√ßos ‚ö°</h1>
   <div id="buttons-container">
     <!-- Bot√µes ser√£o inseridos aqui dinamicamente -->
  </div>
    </div>
    <div class="section">
        <h2>üôè Apoie Nosso Projeto</h2>
        <p>Considere fazer uma doa√ß√£o para apoiar o desenvolvimento da Lightning.</p>
    
        <!-- QR Code clic√°vel -->
        <a href="lightning:brlnfullauto@wallet.br-ln.com" style="display: inline-block;">
            <img src="donate.png" alt="QR Code para doa√ß√£o" style="m</a>ax-width: 200px; width: 50%; height: auto; margin: 10px auto; cursor: pointer;">
        </a>
    </div>
    
    <div class="voltar-container">
        <a href="index_light.html" class="back botao">‚¨ÖÔ∏è Voltar</a>
    </div>


<script>
    function atualizarStatus() {
        fetch('/cgi-bin/status.sh')
            .then(res => {
                if (!res.ok) {
                    throw new Error('Erro ao obter status do sistema.');
                }
                return res.text(); // ‚úÖ <- Aqui trocamos para texto simples
            })
            .then(text => {
                const lines = text.split('\n');
                for (const line of lines) {
                    if (line.includes("CPU:")) {
                        document.getElementById("cpu").innerText = line;
                    } else if (line.includes("RAM:")) {
                        document.getElementById("ram").innerText = line;
                    } else if (line.includes("LND:")) {
                        document.getElementById("lnd").innerText = line;
                    } else if (line.includes("Bitcoind:")) {
                        document.getElementById("bitcoind").innerText = line;
                    } else if (line.includes("Tor:")) {
                        document.getElementById("tor").innerText = line;
                    } else if (line.includes("Blockchain:")) {
                        document.getElementById("blockchain").innerText = line;
                    }
                }
            })
            .catch(error => {
                alert("Erro ao atualizar status: " + error.message);
            });
    }

        // Atualiza a cada 5 segundos
        setInterval(atualizarStatus, 5000);
        window.onload = atualizarStatus;

    function abrirApp(porta) {
        const ip = window.location.hostname;
        const width = 900;
        const height = 600;
        const left = (screen.width - width) / 2;
        const top = (screen.height - height) / 2;

        window.open(`http://${ip}:${porta}`, '_blank',
            `width=${width},height=${height},left=${left},top=${top},resizable=yes`);
    }

    function alternarTema() {
  const caminho = window.location.pathname;
  const nomeArquivo = caminho.substring(caminho.lastIndexOf('/') + 1);

  let proximaPagina = '';
  let novoTema = '';

  if (nomeArquivo.includes('config_dark')) {
    proximaPagina = 'config_light.html';
    novoTema = 'light';
  } else if (nomeArquivo.includes('config_light')) {
    proximaPagina = 'config_dark.html';
    novoTema = 'dark';
  }

  if (proximaPagina !== '') {
    localStorage.setItem("temaAtual", novoTema); // salva prefer√™ncia do usu√°rio
    window.location.href = proximaPagina;
  }
}

// Base URL do Flask
const flaskBaseURL = `http://${window.location.hostname}:5001`;

// Lista dos apps que vamos gerenciar
const apps = ["lnbits", "thunderhub", "simple", "lndg", "lndg-controller", "lnd"];
const buttonsContainer = document.getElementById('buttons-container');

// Cria um bot√£o para cada app
apps.forEach(appName => {
  const button = document.createElement('button');
  button.id = `${appName}-button`;
  button.textContent = `Carregando ${formatAppName(appName)}...`;
  button.dataset.app = appName;
  button.style.margin = '10px';
  button.addEventListener('click', () => toggleService(appName));
  buttonsContainer.appendChild(button);
});

// Atualiza o status dos bot√µes
async function updateButtons() {
  for (const appName of apps) {
    const button = document.getElementById(`${appName}-button`);
    try {
      const response = await fetch(`${flaskBaseURL}/service-status?app=${appName}`);
      const data = await response.json();
      if (data.active) {
        button.textContent = `Parar ${formatAppName(appName)}`;
        button.dataset.action = "stop";
      } else {
        button.textContent = `Iniciar ${formatAppName(appName)}`;
        button.dataset.action = "start";
      }
    } catch (error) {
      button.textContent = `Erro ao carregar ${formatAppName(appName)}`;
      console.error(error);
    }
  }
}

// Fun√ß√£o para start/stop do servi√ßo
async function toggleService(appName) {
  try {
    const response = await fetch(`${flaskBaseURL}/toggle-service?app=${appName}`, {
      method: 'POST'
    });
    const data = await response.json();
    if (data.success) {
      await updateButtons();
    } else {
      alert('Erro: ' + (data.error || 'A√ß√£o falhou'));
    }
  } catch (error) {
    console.error(error);
    alert('Erro ao enviar a√ß√£o');
  }
}

// Fun√ß√£o para melhorar os nomes exibidos
function formatAppName(appName) {
  switch (appName) {
    case "lnbits": return "LNbits";
    case "thunderhub": return "Thunderhub";
    case "simple": return "Simple LNWallet";
    case "lndg": return "LNDG";
    case "lndg-controller": return "LNDG Controller";
    case "lnd": return "LND";
    default: return appName;
  }
}

// Atualiza todos os bot√µes ao carregar a p√°gina
updateButtons();

</script>
</body>
</html>
